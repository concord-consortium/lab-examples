<html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
    <link href="//netdna.bootstrapcdn.com/font-awesome/3.0.2/css/font-awesome.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet" type="text/css">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    <script src="http://lab.concord.org/version/0.5.9/lab/lab.iframe-phone.js"></script>
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,300italic,400,300,700&amp;subset=latin,greek,latin-ext" rel="stylesheet" type="text/css">
    <style type="text/css">
      iframe#interactive-iframe {
         display: inline-block; }
      div#graph {
         display: inline-block;
         vertical-align: top;
         left-margin: 0.5em;
         background-color: #ddf2ff;
         border-radius: 0.25em;
         width: 460px;
         height: 375px; }
    </style>
  </head>
  <body>
    <h1>Embedded Lab interactive with observing and setting a property</h1>
    <p>
      Demonstrates embedding
      <a href="http://lab.concord.org/version/0.5.12/interactives.html#interactives/sam/diffusion/2-temperature.json">Diffusion &amp; Temperature</a>
      Interactive and receiving a callback when the selectedTemperature changes, and setting the selectedTemperature from the outside.
    </p>
    <iframe id="interactive-iframe" width="724px" height="439px"
            frameborder="no" scrolling="no" allowfullscreen="true"
            webkitallowfullscreen="true" mozallowfullscreen="true"
            src="http://lab.concord.org/version/0.5.12/embeddable.html#interactives/sam/diffusion/2-temperature.json">
    </iframe>
    <div>
      Value of selectedTemperature:<span id="selected-temperature">unknown</span>
      <a id="set-temperature-0">Set the temperature to Low</a>
    </div>
    <script>
      // call this function when jQuery thinks the page is ready 
      $(function(){
          // Intitialization
          var iframePhone = new Lab.IFramePhone($('#interactive-iframe')[0], function() {
            console.log('iframePhone ready');
            // the iframe-phone library doesn't support observing properties very well
            // so instead a raw message listener is used here
            window.addEventListener('message', function(message){
              var messageData;

              messageData = message.data;
              if (typeof messageData === 'string') {
                messageData = JSON.parse(messageData);
              }
              if (messageData.type == 'propertyValue'){
                if(messageData.name == 'selectedTemperature'){
                  $('#selected-temperature').html("" + messageData.values)                
                }
              }
            }, false);

            // tell the interactive we want to observe the selectedTemperature property
            iframePhone.post({type: 'observe', propertyName: 'selectedTemperature'});
          });

        // add a listener to the set-temperature-0
        $('#set-temperature-0').click(function(){
          iframePhone.post({type: 'set', propertyName: 'selectedTemperature', propertyValue: '0'});
        })
      });
    </script>
</body>
</html>